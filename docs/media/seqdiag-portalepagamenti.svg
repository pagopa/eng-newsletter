<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="702px" preserveAspectRatio="none" style="width:1140px;height:702px;" version="1.1" viewBox="0 0 1140 702" width="1140px" zoomAndPan="magnify"><defs><filter height="300%" id="fzszhriee4b6e" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#fzszhriee4b6e)" height="173.8633" style="stroke:#000000;stroke-width:2.0;" width="894" x="151" y="399.9043"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="74" x2="74" y1="40.4883" y2="659.3887"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="199" x2="199" y1="40.4883" y2="659.3887"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="667" x2="667" y1="40.4883" y2="659.3887"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1000" x2="1000" y1="40.4883" y2="659.3887"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1064" x2="1064" y1="40.4883" y2="659.3887"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1111" x2="1111" y1="40.4883" y2="659.3887"/><rect fill="#FEFECE" filter="url(#fzszhriee4b6e)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="134" x="5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="120" x="12" y="25.5352">PortalePagamenti</text><rect fill="#FEFECE" filter="url(#fzszhriee4b6e)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="134" x="5" y="658.3887"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="120" x="12" y="678.9238">PortalePagamenti</text><rect fill="#FEFECE" filter="url(#fzszhriee4b6e)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="72" x="161" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="58" x="168" y="25.5352">backend</text><rect fill="#FEFECE" filter="url(#fzszhriee4b6e)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="72" x="161" y="658.3887"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="58" x="168" y="678.9238">backend</text><rect fill="#FEFECE" filter="url(#fzszhriee4b6e)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="114" x="608" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="100" x="615" y="25.5352">pagopa-proxy</text><rect fill="#FEFECE" filter="url(#fzszhriee4b6e)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="114" x="608" y="658.3887"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="100" x="615" y="678.9238">pagopa-proxy</text><rect fill="#FEFECE" filter="url(#fzszhriee4b6e)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="66" x="965" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="52" x="972" y="25.5352">pagopa</text><rect fill="#FEFECE" filter="url(#fzszhriee4b6e)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="66" x="965" y="658.3887"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="52" x="972" y="678.9238">pagopa</text><rect fill="#FEFECE" filter="url(#fzszhriee4b6e)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="34" x="1045" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="20" x="1052" y="25.5352">PM</text><rect fill="#FEFECE" filter="url(#fzszhriee4b6e)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="34" x="1045" y="658.3887"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="20" x="1052" y="678.9238">PM</text><rect fill="#FEFECE" filter="url(#fzszhriee4b6e)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="33" x="1093" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="19" x="1100" y="25.5352">WL</text><rect fill="#FEFECE" filter="url(#fzszhriee4b6e)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="33" x="1093" y="658.3887"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="19" x="1100" y="678.9238">WL</text><polygon fill="#A80036" points="187,67.7988,197,71.7988,187,75.7988,191,71.7988" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="74" x2="193" y1="71.7988" y2="71.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="81" y="67.0566">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="94" y="67.0566">send data RPT</text><path d="M68,84.7988 L68,109.7988 L326,109.7988 L326,94.7988 L316,84.7988 L68,84.7988 " fill="#FBFB77" filter="url(#fzszhriee4b6e)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M316,84.7988 L316,94.7988 L326,94.7988 L316,84.7988 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="237" x="74" y="102.3672">Retrieve information about a payment</text><polygon fill="#A80036" points="655,136.4199,665,140.4199,655,144.4199,659,140.4199" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="199" x2="661" y1="140.4199" y2="140.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="206" y="135.6777">2</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="219" y="135.6777">GET</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="250" y="135.6777">/payment-requests/{rptId}</text><polygon fill="#A80036" points="988,165.7305,998,169.7305,988,173.7305,992,169.7305" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="667" x2="994" y1="169.7305" y2="169.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="674" y="164.9883">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="296" x="687" y="164.9883">nodoVerificaRPT (8001234567890123,Importo)</text><polygon fill="#A80036" points="678,195.041,668,199.041,678,203.041,674,199.041" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="672" x2="999" y1="199.041" y2="199.041"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="684" y="194.2988">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="697" y="194.2988">resp OK (importo update)</text><polygon fill="#0000FF" points="210,224.3516,200,228.3516,210,232.3516,206,228.3516" style="stroke:#0000FF;stroke-width:1.0;"/><line style="stroke:#0000FF;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="204" x2="666" y1="228.3516" y2="228.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="216" y="223.6094">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="265" x="229" y="223.6094">resp OK {importoSingoloVersamento, CCP}</text><path d="M59,241.3516 L59,266.3516 L334,266.3516 L334,251.3516 L324,241.3516 L59,241.3516 " fill="#FBFB77" filter="url(#fzszhriee4b6e)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M324,241.3516 L324,251.3516 L334,251.3516 L324,241.3516 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="254" x="65" y="258.9199">Require a lock (activation) for a payment</text><polygon fill="#A80036" points="655,292.9727,665,296.9727,655,300.9727,659,296.9727" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="199" x2="661" y1="296.9727" y2="296.9727"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="206" y="292.2305">6</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="35" x="219" y="292.2305">POST</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="392" x="258" y="292.2305">/payment-activations {rptId, importoSingoloVersamento, CCP}</text><polygon fill="#A80036" points="988,322.2832,998,326.2832,988,330.2832,992,326.2832" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="667" x2="994" y1="326.2832" y2="326.2832"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="674" y="321.541">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="286" x="687" y="321.541">nodoAttivaRPT (8001234567890123,Importo)</text><polygon fill="#A80036" points="678,351.5938,668,355.5938,678,359.5938,674,355.5938" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="672" x2="999" y1="355.5938" y2="355.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="684" y="350.8516">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="697" y="350.8516">resp OK (importo update)</text><polygon fill="#0000FF" points="210,380.9043,200,384.9043,210,388.9043,206,384.9043" style="stroke:#0000FF;stroke-width:1.0;"/><line style="stroke:#0000FF;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="204" x2="666" y1="384.9043" y2="384.9043"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="216" y="380.1621">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="357" x="229" y="380.1621">resp OK (importoSingoloVersamento, Iban, causale, ente)</text><path d="M151,399.9043 L225,399.9043 L225,406.9043 L215,416.9043 L151,416.9043 L151,399.9043 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="173.8633" style="stroke:#000000;stroke-width:2.0;" width="894" x="151" y="399.9043"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="166" y="413.4727">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="99" x="240" y="412.5391">[polling requests]</text><path d="M517,422.2148 L517,447.2148 L813,447.2148 L813,432.2148 L803,422.2148 L517,422.2148 " fill="#FBFB77" filter="url(#fzszhriee4b6e)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M803,422.2148 L803,432.2148 L813,432.2148 L803,422.2148 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="275" x="523" y="439.7832">Get the activation status and the paymentId</text><polygon fill="#A80036" points="655,473.8359,665,477.8359,655,481.8359,659,477.8359" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="199" x2="661" y1="477.8359" y2="477.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="206" y="473.0938">10</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="27" x="228" y="473.0938">GET</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178" x="259" y="473.0938">/payment-activations/{CCP}</text><polygon fill="#A80036" points="678,503.1465,668,507.1465,678,511.1465,674,507.1465" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="672" x2="999" y1="507.1465" y2="507.1465"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="684" y="502.4043">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="285" x="706" y="502.4043">cdInfoPayment(idDomain,IUV,CCP,idPayment)</text><polygon fill="#A80036" points="988,532.457,998,536.457,988,540.457,992,536.457" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="667" x2="994" y1="536.457" y2="536.457"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="674" y="531.7148">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49" x="696" y="531.7148">resp OK</text><polygon fill="#0000FF" points="210,561.7676,200,565.7676,210,569.7676,206,565.7676" style="stroke:#0000FF;stroke-width:1.0;"/><line style="stroke:#0000FF;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="204" x2="666" y1="565.7676" y2="565.7676"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="216" y="561.0254">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="238" y="561.0254">resp OK (idPagamento)</text><path d="M153,585.7676 L153,610.7676 L713,610.7676 L713,595.7676 L703,585.7676 L153,585.7676 " fill="#FFAAAA" filter="url(#fzszhriee4b6e)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M703,585.7676 L703,595.7676 L713,595.7676 L703,585.7676 " fill="#FFAAAA" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="194" x="329.5" y="603.3359">Redirect on WL with paymentId</text><polygon fill="#A80036" points="1099.5,637.3887,1109.5,641.3887,1099.5,645.3887,1103.5,641.3887" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="74" x2="1105.5" y1="641.3887" y2="641.3887"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="81" y="636.6465">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="103" y="636.6465">send data payment</text><!--MD5=[79f4db6dbe8da24410a567f1cd6848d7]
@startuml docs/media/seqdiag-portalepagamenti

autonumber 
participant portale  as "PortalePagamenti"
participant be as "backend"
participant proxy as "pagopa-proxy"
participant pagopa
participant pm as "PM"
participant wl as "WL"

portale -> be : send data RPT

note over be:  Retrieve information about a payment

be -> proxy : **GET** /payment-requests/{rptId}

proxy -> pagopa : nodoVerificaRPT (8001234567890123,Importo)
pagopa -> proxy : resp OK (importo update)

proxy -[#blue]-> be : resp OK {importoSingoloVersamento, CCP}

note over be:  Require a lock (activation) for a payment

be -> proxy : **POST** /payment-activations {rptId, importoSingoloVersamento, CCP}

proxy -> pagopa : nodoAttivaRPT (8001234567890123,Importo)
pagopa -> proxy : resp OK (importo update)


proxy -[#blue]-> be : resp OK (importoSingoloVersamento, Iban, causale, ente)

loop polling requests
note over proxy:  Get the activation status and the paymentId

be -> proxy : **GET** /payment-activations/{CCP}

pagopa -> proxy : cdInfoPayment(idDomain,IUV,CCP,idPayment)

proxy -> pagopa : resp OK

proxy -[#blue]-> be : resp OK (idPagamento)
end

note over be, proxy #FFAAAA: Redirect on WL with paymentId

portale -> wl : send data payment

@enduml 

PlantUML version 1.2020.26(Mon Dec 21 18:45:07 CET 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>